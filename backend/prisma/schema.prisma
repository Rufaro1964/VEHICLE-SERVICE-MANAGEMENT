generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model audit_log {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  action     String    @db.VarChar(100)
  table_name String?   @db.VarChar(50)
  record_id  Int?
  old_values String?   @db.LongText
  new_values String?   @db.LongText
  ip_address String?   @db.VarChar(45)
  user_agent String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users?    @relation(fields: [user_id], references: [id], onUpdate: Restrict, map: "audit_log_ibfk_1")

  @@index([user_id], map: "user_id")
}

model import_export_logs {
  id                 Int                               @id @default(autoincrement())
  user_id            Int
  operation_type     import_export_logs_operation_type
  entity_type        import_export_logs_entity_type
  file_name          String                            @db.VarChar(255)
  file_path          String?                           @db.VarChar(500)
  file_size          Int?
  total_records      Int?                              @default(0)
  successful_records Int?                              @default(0)
  failed_records     Int?                              @default(0)
  error_log          String?                           @db.Text
  status             import_export_logs_status?        @default(pending)
  parameters         String?                           @db.LongText
  started_at         DateTime?                         @default(now()) @db.Timestamp(0)
  completed_at       DateTime?                         @db.Timestamp(0)
  users              users                             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "import_export_logs_ibfk_1")

  @@index([started_at], map: "idx_created")
  @@index([operation_type], map: "idx_operation")
  @@index([status], map: "idx_status")
  @@index([user_id], map: "idx_user")
}

model notifications {
  id             Int                     @id @default(autoincrement())
  user_id        Int?
  vehicle_id     Int?
  type           notifications_type
  title          String                  @db.VarChar(200)
  message        String                  @db.Text
  is_read        Boolean?                @default(false)
  sent_via       notifications_sent_via? @default(in_app)
  scheduled_time DateTime?               @db.DateTime(0)
  sent_at        DateTime?               @db.DateTime(0)
  created_at     DateTime?               @default(now()) @db.Timestamp(0)
  users          users?                  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "notifications_ibfk_1")
  vehicles       vehicles?               @relation(fields: [vehicle_id], references: [id], onUpdate: Restrict, map: "notifications_ibfk_2")

  @@index([user_id, is_read], map: "idx_user_notifications")
  @@index([vehicle_id], map: "vehicle_id")
}

model reports {
  id           Int                 @id @default(autoincrement())
  report_type  reports_report_type
  title        String              @db.VarChar(200)
  description  String?             @db.Text
  period_start DateTime?           @db.Date
  period_end   DateTime?           @db.Date
  generated_by Int?
  file_path    String?             @db.VarChar(500)
  file_size    Int?
  parameters   String?             @db.LongText
  status       reports_status?     @default(pending)
  created_at   DateTime?           @default(now()) @db.Timestamp(0)
  completed_at DateTime?           @db.Timestamp(0)
  users        users?              @relation(fields: [generated_by], references: [id], onUpdate: Restrict, map: "reports_ibfk_1")

  @@index([generated_by], map: "generated_by")
  @@index([period_start, period_end], map: "idx_period")
  @@index([status], map: "idx_status")
  @@index([report_type], map: "idx_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model service_types {
  id                 Int                     @id @default(autoincrement())
  name               String                  @db.VarChar(100)
  description        String?                 @db.Text
  estimated_duration Int?
  base_labor_cost    Decimal?                @default(0.00) @db.Decimal(10, 2)
  base_parts_cost    Decimal?                @default(0.00) @db.Decimal(10, 2)
  mileage_interval   Int?
  time_interval      Int?
  category           service_types_category? @default(routine)
  is_active          Boolean?                @default(true)
  created_at         DateTime?               @default(now()) @db.Timestamp(0)
  updated_at         DateTime?               @default(now()) @db.Timestamp(0)
  services           services[]

  @@index([is_active], map: "idx_active")
  @@index([category], map: "idx_category")
}

model services {
  id                   Int                      @id @default(autoincrement())
  vehicle_id           Int
  service_type_id      Int?
  invoice_number       String                   @unique(map: "invoice_number") @db.VarChar(50)
  service_date         DateTime                 @db.Date
  scheduled_date       DateTime?                @db.Date
  completed_date       DateTime?                @db.DateTime(0)
  mileage_at_service   Decimal                  @db.Decimal(10, 2)
  technician_id        Int?
  labor_cost           Decimal?                 @default(0.00) @db.Decimal(10, 2)
  parts_cost           Decimal?                 @default(0.00) @db.Decimal(10, 2)
  tax_amount           Decimal?                 @default(0.00) @db.Decimal(10, 2)
  discount_amount      Decimal?                 @default(0.00) @db.Decimal(10, 2)
  total_cost           Decimal                  @db.Decimal(10, 2)
  payment_method       services_payment_method? @default(cash)
  payment_status       services_payment_status? @default(pending)
  payment_date         DateTime?                @db.Date
  service_status       services_service_status? @default(scheduled)
  customer_notes       String?                  @db.Text
  internal_notes       String?                  @db.Text
  customer_feedback    String?                  @db.Text
  rating               Int?
  next_service_date    DateTime?                @db.Date
  next_service_mileage Decimal?                 @db.Decimal(10, 2)
  created_at           DateTime?                @default(now()) @db.Timestamp(0)
  updated_at           DateTime?                @default(now()) @db.Timestamp(0)
  vehicles             vehicles                 @relation(fields: [vehicle_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "services_ibfk_1")
  service_types        service_types?           @relation(fields: [service_type_id], references: [id], onUpdate: Restrict, map: "services_ibfk_2")
  users                users?                   @relation(fields: [technician_id], references: [id], onUpdate: Restrict, map: "services_ibfk_3")
  spare_parts          spare_parts[]

  @@index([invoice_number], map: "idx_invoice")
  @@index([payment_status], map: "idx_payment_status")
  @@index([service_date], map: "idx_service_date")
  @@index([service_status], map: "idx_status")
  @@index([vehicle_id], map: "idx_vehicle")
  @@index([service_type_id], map: "service_type_id")
  @@index([technician_id], map: "technician_id")
}

model settings {
  id            Int                    @id @default(autoincrement())
  setting_key   String                 @unique(map: "setting_key") @db.VarChar(100)
  setting_value String?                @db.Text
  setting_type  settings_setting_type? @default(string)
  category      String?                @default("general") @db.VarChar(50)
  description   String?                @db.Text
  is_public     Boolean?               @default(false)
  created_at    DateTime?              @default(now()) @db.Timestamp(0)
  updated_at    DateTime?              @default(now()) @db.Timestamp(0)

  @@index([category], map: "idx_category")
  @@index([setting_key], map: "idx_key")
}

model spare_parts {
  id              Int       @id @default(autoincrement())
  service_id      Int
  part_name       String    @db.VarChar(200)
  part_number     String?   @db.VarChar(100)
  manufacturer    String?   @db.VarChar(100)
  quantity        Decimal   @default(1.00) @db.Decimal(8, 2)
  unit_cost       Decimal   @db.Decimal(10, 2)
  total_cost      Decimal   @db.Decimal(10, 2)
  warranty_months Int?      @default(0)
  stock_code      String?   @db.VarChar(100)
  notes           String?   @db.Text
  created_at      DateTime? @default(now()) @db.Timestamp(0)
  services        services  @relation(fields: [service_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "spare_parts_ibfk_1")

  @@index([part_number], map: "idx_part_number")
  @@index([service_id], map: "idx_service")
}

model users {
  id                 Int                  @id @default(autoincrement())
  username           String               @unique(map: "username") @db.VarChar(50)
  password           String               @db.VarChar(255)
  email              String               @unique(map: "email") @db.VarChar(100)
  phone              String?              @db.VarChar(20)
  role               users_role?          @default(user)
  language           users_language?      @default(en)
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  audit_log          audit_log[]
  import_export_logs import_export_logs[]
  notifications      notifications[]
  reports            reports[]
  services           services[]
  vehicles           vehicles[]
}

model vehicles {
  id                       Int             @id @default(autoincrement())
  user_id                  Int?
  plate_number             String          @unique(map: "plate_number") @db.VarChar(20)
  chassis_number           String          @unique(map: "chassis_number") @db.VarChar(50)
  make                     String?         @db.VarChar(50)
  model                    String?         @db.VarChar(50)
  year                     Int?
  color                    String?         @db.VarChar(30)
  vin                      String?         @db.VarChar(50)
  engine_type              String?         @db.VarChar(50)
  current_mileage          Decimal?        @default(0.00) @db.Decimal(10, 2)
  last_service_mileage     Decimal?        @default(0.00) @db.Decimal(10, 2)
  last_service_date        DateTime?       @db.Date
  next_service_due         Decimal?        @db.Decimal(10, 2)
  next_service_date        DateTime?       @db.Date
  qr_code_path             String?         @db.VarChar(255)
  notification_preferences String?         @db.LongText
  created_at               DateTime?       @default(now()) @db.Timestamp(0)
  notifications            notifications[]
  services                 services[]
  users                    users?          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "vehicles_ibfk_1")

  @@index([next_service_date], map: "idx_next_service")
  @@index([plate_number], map: "idx_plate")
  @@index([user_id], map: "user_id")
}

enum reports_report_type {
  financial
  service
  inventory
  customer
  vehicle
}

enum import_export_logs_operation_type {
  import
  export
}

enum import_export_logs_entity_type {
  vehicles
  services
  customers
  inventory
}

enum settings_setting_type {
  string
  number
  boolean
  json
  array
}

enum notifications_type {
  service_due
  reminder
  system
  alert
}

enum users_role {
  user
  admin
  technician
}

enum users_language {
  en
  es
  fr
}

enum notifications_sent_via {
  email
  sms
  both
  in_app
}

enum service_types_category {
  routine
  repair
  emergency
  inspection
}

enum reports_status {
  pending
  generating
  completed
  failed
}

enum import_export_logs_status {
  pending
  processing
  completed
  failed
}

enum services_payment_method {
  cash
  card
  bank_transfer
  upi
  credit
}

enum services_payment_status {
  paid
  pending
  partial
  refunded
}

enum services_service_status {
  scheduled
  in_progress
  completed
  cancelled
  delayed
}
